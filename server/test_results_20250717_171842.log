
> rhythm-server@0.1.0 test /Users/louisciccone/Desktop/Rythm_Daw/server
> cross-env NODE_ENV=test jest --config=jest.config.js

FAIL test/websocket.e2e.spec.ts (15.985 s)
  ● Console

    console.warn
      Running with mock S3 client - file operations will not persist

      40 |       }
      41 |     } else {
    > 42 |       console.warn('Running with mock S3 client - file operations will not persist');
         |               ^
      43 |     }
      44 |
      45 |     this.s3 = new AWS.S3();

      at new AwsS3Service (src/modules/files/aws-s3.service.ts:42:15)
      at TestingInjector.instantiateClass (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/injector.js:373:19)
      at callback (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/injector.js:65:45)
      at TestingInjector.resolveConstructorParams (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/injector.js:145:24)
      at TestingInjector.loadInstance (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 4)
      at TestingInstanceLoader.createInstancesOfProviders (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 11)
      at TestingInstanceLoader.createInstances (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../node_modules/.pnpm/@nestjs+testing@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0._bde94f0843f7709eed75faa2d8eec233/node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../node_modules/.pnpm/@nestjs+testing@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0._bde94f0843f7709eed75faa2d8eec233/node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../node_modules/.pnpm/@nestjs+testing@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0._bde94f0843f7709eed75faa2d8eec233/node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (test/websocket.e2e.spec.ts:19:27)

  ● WebSocket (e2e) › should connect to WebSocket server

    TypeError: server.on is not a function

      28 |     
      29 |     // Initialize app
    > 30 |     await app.init();
         |     ^
      31 |     
      32 |     // Start HTTP server
      33 |     httpServer = await app.listen(TEST_PORT);

      at IoAdapter.bindClientConnect (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/adapters/ws-adapter.js:23:16)
      at WebSocketsController.subscribeEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:54:17)
      at WebSocketsController.subscribeToServerEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:45:14)
      at WebSocketsController.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:30:14)
      at SocketModule.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:47:35)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:38
      at IteratorWithOperators.forEach (../node_modules/.pnpm/iterare@1.2.1/node_modules/iterare/src/iterate.ts:202:13)
      at SocketModule.connectAllGateways (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:14)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:61
          at ModulesContainer.forEach (<anonymous>)
      at SocketModule.register (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:17)
      at Proxy.registerWsModule (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:88:27)
      at Proxy.registerModules (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:77:14)
      at Proxy.init (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:98:20)
      at Object.<anonymous> (test/websocket.e2e.spec.ts:30:5)

  ● WebSocket (e2e) › should send and receive messages

    TypeError: server.on is not a function

      28 |     
      29 |     // Initialize app
    > 30 |     await app.init();
         |     ^
      31 |     
      32 |     // Start HTTP server
      33 |     httpServer = await app.listen(TEST_PORT);

      at IoAdapter.bindClientConnect (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/adapters/ws-adapter.js:23:16)
      at WebSocketsController.subscribeEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:54:17)
      at WebSocketsController.subscribeToServerEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:45:14)
      at WebSocketsController.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:30:14)
      at SocketModule.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:47:35)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:38
      at IteratorWithOperators.forEach (../node_modules/.pnpm/iterare@1.2.1/node_modules/iterare/src/iterate.ts:202:13)
      at SocketModule.connectAllGateways (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:14)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:61
          at ModulesContainer.forEach (<anonymous>)
      at SocketModule.register (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:17)
      at Proxy.registerWsModule (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:88:27)
      at Proxy.registerModules (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:77:14)
      at Proxy.init (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:98:20)
      at Object.<anonymous> (test/websocket.e2e.spec.ts:30:5)

  ● WebSocket (e2e) › should handle disconnection

    TypeError: server.on is not a function

      28 |     
      29 |     // Initialize app
    > 30 |     await app.init();
         |     ^
      31 |     
      32 |     // Start HTTP server
      33 |     httpServer = await app.listen(TEST_PORT);

      at IoAdapter.bindClientConnect (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/adapters/ws-adapter.js:23:16)
      at WebSocketsController.subscribeEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:54:17)
      at WebSocketsController.subscribeToServerEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:45:14)
      at WebSocketsController.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:30:14)
      at SocketModule.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:47:35)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:38
      at IteratorWithOperators.forEach (../node_modules/.pnpm/iterare@1.2.1/node_modules/iterare/src/iterate.ts:202:13)
      at SocketModule.connectAllGateways (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:14)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:61
          at ModulesContainer.forEach (<anonymous>)
      at SocketModule.register (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:17)
      at Proxy.registerWsModule (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:88:27)
      at Proxy.registerModules (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:77:14)
      at Proxy.init (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:98:20)
      at Object.<anonymous> (test/websocket.e2e.spec.ts:30:5)


  ● Test suite failed to run

    thrown: "Exceeded timeout of 15000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      54 |   });
      55 |
    > 56 |   afterAll(async () => {
         |   ^
      57 |     // Close WebSocket server
      58 |     if (wss) {
      59 |       wss.close();

      at test/websocket.e2e.spec.ts:56:3
      at Object.<anonymous> (test/websocket.e2e.spec.ts:11:1)

FAIL test/ws-heartbeat-e2e.test.ts (15.292 s)
  ● ChatGateway (e2e) › should establish WebSocket connection and handle ping/pong

    TypeError: server.on is not a function

      74 |     io = new Server(httpServer);
      75 |     
    > 76 |     await app.init();
         |     ^
      77 |   });
      78 |
      79 |   afterAll(async () => {

      at IoAdapter.bindClientConnect (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/adapters/ws-adapter.js:23:16)
      at WebSocketsController.subscribeEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:54:17)
      at WebSocketsController.subscribeToServerEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:45:14)
      at WebSocketsController.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:30:14)
      at SocketModule.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:47:35)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:38
      at IteratorWithOperators.forEach (../node_modules/.pnpm/iterare@1.2.1/node_modules/iterare/src/iterate.ts:202:13)
      at SocketModule.connectAllGateways (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:14)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:61
          at ModulesContainer.forEach (<anonymous>)
      at SocketModule.register (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:17)
      at Proxy.registerWsModule (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:88:27)
      at Proxy.registerModules (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:77:14)
      at Proxy.init (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:98:20)
      at Object.<anonymous> (test/ws-heartbeat-e2e.test.ts:76:5)

  ● ChatGateway (e2e) › should disconnect client after missing pongs

    TypeError: server.on is not a function

      74 |     io = new Server(httpServer);
      75 |     
    > 76 |     await app.init();
         |     ^
      77 |   });
      78 |
      79 |   afterAll(async () => {

      at IoAdapter.bindClientConnect (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/adapters/ws-adapter.js:23:16)
      at WebSocketsController.subscribeEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:54:17)
      at WebSocketsController.subscribeToServerEvents (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:45:14)
      at WebSocketsController.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/web-sockets-controller.js:30:14)
      at SocketModule.connectGatewayToServer (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:47:35)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:38
      at IteratorWithOperators.forEach (../node_modules/.pnpm/iterare@1.2.1/node_modules/iterare/src/iterate.ts:202:13)
      at SocketModule.connectAllGateways (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:36:14)
      at ../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:61
          at ModulesContainer.forEach (<anonymous>)
      at SocketModule.register (../node_modules/.pnpm/@nestjs+websockets@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator_aa0769972f09784d8464dd424c71bca3/node_modules/@nestjs/websockets/socket-module.js:31:17)
      at Proxy.registerWsModule (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:88:27)
      at Proxy.registerModules (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:77:14)
      at Proxy.init (../node_modules/.pnpm/@nestjs+core@11.1.3_@nestjs+common@11.1.3_class-transformer@0.5.1_class-validator@0.14._c362ab2a5d80cd719c88bbc8d32eee7a/node_modules/@nestjs/core/nest-application.js:98:20)
      at Object.<anonymous> (test/ws-heartbeat-e2e.test.ts:76:5)


  ● Test suite failed to run

    thrown: "Exceeded timeout of 15000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      77 |   });
      78 |
    > 79 |   afterAll(async () => {
         |   ^
      80 |     await app.close();
      81 |     httpServer.close();
      82 |   });

      at test/ws-heartbeat-e2e.test.ts:79:3
      at Object.<anonymous> (test/ws-heartbeat-e2e.test.ts:14:1)

[32m[Nest] 49640  - [39m07/17/2025, 5:19:14 PM [32m    LOG[39m [38;5;3m[NestApplication] [39m[32mNest application successfully started[39m
FAIL test/websocket.heartbeat.spec.ts (15.249 s)
  ● WebSocket Heartbeat › should connect to the WebSocket server

    TypeError: Cannot read properties of undefined (reading 'on')

      107 |     const client = mockIo('http://localhost:3000');
      108 |     
    > 109 |     client.on('connect', () => {
          |            ^
      110 |       expect(client.connected).toBe(true);
      111 |       client.disconnect();
      112 |       done();

      at Object.<anonymous> (test/websocket.heartbeat.spec.ts:109:12)

  ● WebSocket Heartbeat › should handle ping-pong

    TypeError: Cannot read properties of undefined (reading 'emit')

      120 |     const client = mockIo('http://localhost:3000');
      121 |     
    > 122 |     client.emit('ping', { timestamp: 12345 }, (response: any) => {
          |            ^
      123 |       expect(response).toHaveProperty('timestamp');
      124 |       expect(response.timestamp).toBe(12345);
      125 |       client.disconnect();

      at Object.<anonymous> (test/websocket.heartbeat.spec.ts:122:12)

  ● WebSocket Heartbeat › should handle disconnection

    TypeError: Cannot read properties of undefined (reading 'on')

      131 |     const client = mockIo('http://localhost:3000');
      132 |     
    > 133 |     client.on('disconnect', () => {
          |            ^
      134 |       expect(client.connected).toBe(false);
      135 |       done();
      136 |     });

      at Object.<anonymous> (test/websocket.heartbeat.spec.ts:133:12)

  ● WebSocket Heartbeat › should trigger gateway connection handlers

    TypeError: Cannot read properties of undefined (reading 'emit')

      146 |     
      147 |     // Simulate connection
    > 148 |     client.emit('connection');
          |            ^
      149 |     
      150 |     process.nextTick(() => {
      151 |       expect(handleConnectionSpy).toHaveBeenCalledTimes(1);

      at Object.<anonymous> (test/websocket.heartbeat.spec.ts:148:12)


  ● Test suite failed to run

    thrown: "Exceeded timeout of 15000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

       95 |   }, 10000);
       96 |
    >  97 |   afterAll(async () => {
          |   ^
       98 |     await app.close();
       99 |     jest.clearAllMocks();
      100 |   });

      at test/websocket.heartbeat.spec.ts:97:3
      at Object.<anonymous> (test/websocket.heartbeat.spec.ts:76:1)

